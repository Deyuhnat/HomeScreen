<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Service</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  <link rel="stylesheet" href="service.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" defer></script>
</head>
<style>
  table {
    font-family: arial, sans-serif;
    border-collapse: collapse;
    width: 100%;
  }

  td,
  th {
    border: 1px solid #dddddd;
    text-align: left;
    padding: 8px;
  }

  tr:nth-child(even) {
    background-color: #dddddd;
  }
</style>

<body>
  <div class="dev-image"></div>
  <div class="menu-bar">
    <h1 class="logo">Dev<span>Service</span></h1>
    <ul>
      <li><a href="Home.html">Home</a></li>
      <li><a href="service.html">Service</a></li>
      <li><a href="user.html">User</a></li>
      <li><a href="#">Pages <i class="fas fa-caret-down"></i></a>
        <div class="dropdown-menu">
          <ul>
            <!-- <li><a href="#">""</a></li> -->
            <li>
              <a href="#">Community <i class="fas fa-caret-right"></i></a>

              <div class="dropdown-menu-1">
                <ul>
                  <li><a href="#">Event</a></li>
                  <li><a href="#">Discussion</a></li>
                  <li><a href="#">Blog</a></li>
                </ul>
              </div>
            </li>
            <li><a href="#">FAQ</a></li>
          </ul>
        </div>
      </li>
      <li><a href="#">Blog</a>
      </li>
      <li><a href="#">Contact us</a></li>
    </ul>
  </div>

  <div class="container-sm" style="width: 40%; margin-top: 30px;">
    <!-- <h1>Bootstrap form demo</h1> -->
    <form action="">
      <div class="mb-3">
        <div class="mb-3">
          <label for="exampleFormControlInput1" class="form-label">Filter</label>
          <input type="email" class="form-control" id="exampleFormControlInput1" placeholder="What are you looking for?">
        </div>
        <select class="form-select" aria-label="Default select example">
          <option selected>Open this select menu</option>
          <option value="1">Id</option>
          <option value="Name">Name</option>
          <option value="2">Min Price</option>
          <option value="3">Max Price</option>
        </select>
      </div>

      <!-- <input id="page_number_id" type="number" value="1" placeholder="Go to page"> -->
      <!-- <div class="mb-3">
        <label for="exampleFormControlInput1" class="form-label">Email address</label>
        <input type="number" class="form-control" id="exampleFormControlInput1" placeholder="name@example.com">
        <button onclick="goToPage()">Go</button>
      </div> -->
      
    </form>
  

    <form class="row g-3">
      <div class="col-auto">
        <label for="staticEmail2" class="visually-hidden">Page</label>
        <input type="text" readonly class="form-control-plaintext" id="staticEmail2" value="Page">
      </div>
      <div class="col-auto">
        <label for="inputPassword2" class="visually-hidden">Page</label>
        <input type="number" class="form-control" id="inputPassword2" placeholder="1">
      </div>
      <div class="col-auto">
        <button type="submit" class="btn btn-primary mb-3">Go</button>
      </div>
    </form>

  </div>

  <!-- <input id="page_filter_id" type="text" value="" placeholder="Filter">
  <select id="spinner_list_id">
    <option value="Id">Id</option>
    <option value="Name">Name</option>
    <option value="Min Price">Min Price</option>
    <option value="Max Price">Max Price</option>
  </select>
  <button onclick="goToPageWithFilter()">Go</button> -->

  <!-- <table id="service_table"> -->
  <div class="card-container" id="service_cards">

  </div>

  </table>
  <div id="pageable_div_id"></div>



  <script>
    var pageSize = 10;
    var previousPage, nextPage
    getServices();

    function displayPageable(pageNumber, totalElement, totalPages) {
      totalPages -= 1;
      var previousButtonStatus = "";
      var nextButtonStatus = "";

      previousPage = pageNumber - 1;
      if (previousPage < 0) {
        previousButtonStatus = "disabled";
        previousPage = 0;
      }
      nextPage = pageNumber + 1;
      if (nextPage > totalPages) {
        nextButtonStatus = "disabled";
        nextPage = totalPages;
      }
      var html = '<button id="previous_button_id" onclick="getServices(previousPage)" ' + previousButtonStatus + '>Previous</button><button onclick="getServices(nextPage)" ' + nextButtonStatus + '>Next</button>' +
        '<br><span>' + 'Page ' + (pageNumber + 1) + ' of ' + (totalPages + 1) + '</span>';
      document.getElementById("pageable_div_id").innerHTML = html;
    }

    function getServices(page) {
      var inputPageElement = document.getElementById("page_number_id");
      var filter = document.getElementById("page_filter_id").value;
      var type = document.getElementById("spinner_list_id").value;
      var pageNum = inputPageElement.value;
      if (page == null) {
        page = pageNum - 1;
      }
      var link = "";
      if (filter !== "") {
        if (type === "Min Price") {
          type = "price"
          var priceType = "min"
        }
        if (type === "Max Price") {
          type = "price"
          var priceType = "max"
        }
        link = "http://localhost:8080/api/service?name=" + filter + "&type=" + type.toLowerCase() + "&page=" + page + "&priceType=" + priceType;
      }
      else {
        link = "http://localhost:8080/api/service?page=" + page
      }
      $.get(link, function (data, status) {
        console.log(data);
        var html = '';


        for (var i = 0; i < data.services.length; i++) {
          html += '<div class="card">\n' +
            '  <div class="card-content">\n' +
            '    <h2 class="card-id">' + data.services[i].id + '</h2>\n' +
            '    <p class="card-uid">' + data.services[i].uid + '</p>\n' +
            '    <h3 class="card-name">' + data.services[i].name + '</h3>\n' +
            '    <p class="card-price">' + data.services[i].price + '</p>\n' +
            '    <p class="card-description">' + data.services[i].description + '</p>\n' +
            '    <a href="' + data.services[i].infoLink + '" class="info-button">More Info</a>\n' +
            '  </div>\n' +
            '</div>';
        }

        document.getElementById("service_cards").innerHTML = html;
        displayPageable(data.currentPage, data.totalItems, data.totalPages);
        inputPageElement.value = "";
      });
    }

    function goToPage() {
      var pageNum = document.getElementById("page_number_id").value - 1;
      var filter = document.getElementById("page_filter_id").value;
      var type = document.getElementById("spinner_list_id").value;
      if (pageNum < 0) {
        pageNum = 0;
      }
      var link = "";
      if (filter !== "") {
        if (type === "Min Price") {
          type = "price"
          var priceType = "min"
        }
        if (type === "Max Price") {
          type = "price"
          var priceType = "max"
        }
        link = "http://localhost:8080/api/service?name=" + filter + "&type=" + type.toLowerCase() + "&page=" + pageNum + "&priceType=" + priceType;
      }
      else {
        link = "http://localhost:8080/api/service?page=" + pageNum;
      }
      // if (page == null) {
      //     page = pageNum;
      // }
      $.get(link, function (data, status) {
        console.log(data);
        var html = '';


        for (var i = 0; i < data.services.length; i++) {
          html += '<div class="card">\n' +
            '  <div class="card-content">\n' +
            '    <h2 class="card-id">' + data.services[i].id + '</h2>\n' +
            '    <p class="card-uid">' + data.services[i].uid + '</p>\n' +
            '    <h3 class="card-name">' + data.services[i].name + '</h3>\n' +
            '    <p class="card-price">' + data.services[i].price + '</p>\n' +
            '    <p class="card-description">' + data.services[i].description + '</p>\n' +
            '    <a href="' + data.services[i].infoLink + '" class="info-button">More Info</a>\n' +
            '  </div>\n' +
            '</div>';
        }

        document.getElementById("service_cards").innerHTML = html;
        displayPageable(data.currentPage, data.totalItems, data.totalPages);
        inputPageElement.value = "";
      });
    }

    function goToPageWithFilter() {
      var pageNum = document.getElementById("page_number_id").value;
      var filter = document.getElementById("page_filter_id").value;
      var type = document.getElementById("spinner_list_id").value;
      if (pageNum < 0) {
        pageNum = 0;
      }
      var link = "";
      if (filter !== "") {
        if (type === "Min Price") {
          type = "price"
          var priceType = "min"
        }
        if (type === "Max Price") {
          type = "price"
          var priceType = "max"
        }
        link = "http://localhost:8080/api/service?name=" + filter + "&type=" + type.toLowerCase() + "&page=" + pageNum + "&priceType=" + priceType;
      }
      else {
        link = "http://localhost:8080/api/service?page=0"
      }
      $.get(link, function (data, status) {
        console.log(data);
        var html = '';

        for (var i = 0; i < data.services.length; i++) {
          html += '<div class="card">\n' +
            '  <div class="card-content">\n' +
            '    <h2 class="card-id">' + data.services[i].id + '</h2>\n' +
            '    <p class="card-uid">' + data.services[i].uid + '</p>\n' +
            '    <h3 class="card-name">' + data.services[i].name + '</h3>\n' +
            '    <p class="card-price">' + data.services[i].price + '</p>\n' +
            '    <p class="card-description">' + data.services[i].description + '</p>\n' +
            '    <a href="' + data.services[i].infoLink + '" class="info-button">More Info</a>\n' +
            '  </div>\n' +
            '</div>';
        }

        document.getElementById("service_cards").innerHTML = html;
        displayPageable(data.currentPage, data.totalItems, data.totalPages);
        inputPageElement.value = "";
      });
    }
  </script>
</body>

</html>